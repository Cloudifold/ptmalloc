ptmalloc3 help
=====

## 必要的资料

* * *

###### 支持的指针与大小表示： (4/8 字节)

大小要求： 无符号 / 与指针宽度对齐。

###### 对齐 ( 默认 8 字节 )

几乎足以适配所有现行机器与C编译器。
可以修改[^MALLOC_ALIGNMENT]的宏 获得更大的对齐(***最大128字节!***),
不过代价是更大的空间消耗。


###### 每个已分配区块[^allocated chunk]的最小开销([^chunk]头)： (4/8 字节) or (8/16 字节)

每个分配的块都有一个隐藏字来表示开销大小与一些状态信息,
如果定义了[^FOOTERS]还会有附加的交叉检查字。

###### 最小可分配大小： (16/32 字节)

就算是0字节的请求( malloc(0) )也会返回指向有 最小可分配大小 可用空间的[^chunk]。 
最大的空间浪费( 即实际分配的字节数 - 请求的字节数 ) 不会大于 **每个已分配区块[^allocated chunk]的最小开销([^chunk]头)**。
除非 请求的字节数 >=  mmap_threshold , 
这种情况 malloc 会用 mmap 分配, 最坏情况是 32字节 + 系统页的其他部分 。(通常为 4096/8192 字节)。

###### 安全： 静态安全 / 或多或少可选

malloc 的"安全性" 是指恶意代码加重 调用malloc的代码中的错误 
(比如释放未分配的空间 或 溢出某个[^chunk]) 的影响的能力。
这个 malloc 保证不会修改 [^堆底以下] 的任何 内存地址(即静态变量) , 即使存在使用错误。

这个例程还会检测大多数不当的[^释放]与[^重分配]
只要malloc本身的静态簿记没有被某种方式污染,这些都有效。

这只是安全性的一个方面-这些检查不能也不能够检测到所有可能的编程错误。
如果将[^FOOTERS]置为非零,则每个已分配的块均携带一个附加的**校验字**,以验证*是否已从其空间中对其进行了分配。*
这些词在使用malloc的程序的每次执行中都是相同的,但在不同的执行中是不同的,因此不能释放外部构建的伪块(除非……)。

【edit log -- end】







[^释放]: free
[^重分配]: realloc
[^堆底以下]: below the base of heap
